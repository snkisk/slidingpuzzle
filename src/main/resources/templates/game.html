<!DOCTYPE html>
<html lang=“ja”>
  <head>
    <meta charset=“UFT-8”>
    <title>CSS</title>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  </head>
  <body>
<style>
  .container {
    display: flex;
    flex-wrap: wrap;
    margin: 5% 30%;
    border: solid 1px gray;
  }
  .container .inner {
    flex: 0 0 20%;
    position: relative;
  }
  .container .inner::before {
    content: "";
    display: block;
    padding-top: 100%;
  }
  .container .inner span {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    font-size: 3vmax;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .container .inner:nth-child(even) span {
    background-color: #eee;
  }
  .container .inner span.block {
    background: url('/image/wall.png') center center /cover no-repeat;
  }
  .container .inner span.start:before {
    content: 'start';
    position: absolute;
    color: #eee;
    text-shadow: 1px 1px 0 #000, -1px 1px 0 #000, 1px -1px 0 #000, -1px -1px 0 #000;
    opacity: 0.2;
  }
  .container .inner span.goal:before {
    content: 'goal';
    position: absolute;
    color: #eee;
    text-shadow: 1px 1px 0 #000, -1px 1px 0 #000, 1px -1px 0 #000, -1px -1px 0 #000;
    opacity: 0.2;
  }

  @media only screen and (max-width: 980px) {
    /* スマホ */
    .container {
      margin: initial;
    }
  }
</style>
<div class="container">
  <th:block th:each="i : ${#numbers.sequence(1, 5)}">
    <th:block th:each="j : ${#numbers.sequence(1, 5)}">
      <div class="inner">
        <th:block th:switch="true">
          <span th:id="|${i}${j}|" th:case="${i == 4 && j == 1}" class="block"></span>
          <span th:id="|${i}${j}|" th:case="${i == 5 && j == 1}" class="start">〇</span>
          <span th:id="|${i}${j}|" th:case="${i == 1 && j == 5}" class="goal"></span>
          <span th:id="|${i}${j}|" th:case="*"></span>
        </th:block>
      </div>
    </th:block>
  </th:block>
</div>

<!--
<div class="container">
  <div class="inner"><span id=11></span></div>
  <div class="inner"><span id=12></span></div>
  <div class="inner"><span id=13></span></div>
  <div class="inner"><span id=14></span></div>
  <div class="inner"><span id=15 class="goal"></span></div>
  <div class="inner"><span id=21></span></div>
  <div class="inner"><span id=22></span></div>
  <div class="inner"><span id=23></span></div>
  <div class="inner"><span id=24></span></div>
  <div class="inner"><span id=25></span></div>
  <div class="inner"><span id=31></span></div>
  <div class="inner"><span id=32></span></div>
  <div class="inner"><span id=33></span></div>
  <div class="inner"><span id=34></span></div>
  <div class="inner"><span id=35></span></div>
  <div class="inner"><span id=41 class="block"></span></div>
  <div class="inner"><span id=42></span></div>
  <div class="inner"><span id=43></span></div>
  <div class="inner"><span id=44></span></div>
  <div class="inner"><span id=45></span></div>
  <div class="inner"><span id=51 class="start">〇</span></div>
  <div class="inner"><span id=52></span></div>
  <div class="inner"><span id=53></span></div>
  <div class="inner"><span id=54></span></div>
  <div class="inner"><span id=55></span></div>
</div>
-->

  <div id="message"></div>
  <div id="message2"></div>

  <script>
    $(function () {
      $(window).keydown(function (e) {
        if (! [37, 38, 39, 40].includes(e.keyCode)) {
          // 十字キー以外なので処理終了.
          return false;
        }

        let is_wall_or_block = false;
        while (! is_wall_or_block) {
          let [row, column] = $('.container > .inner > span:contains("〇")')[0].id.split``.map(val => parseInt(val));
          switch (e.keyCode) {
            case 37:
              // 左
              is_wall_or_block = isWallOrBlock(row, column - 1);
              moveCircle(row, column, row, column - 1, is_wall_or_block);
              break;
            case 38:
              // 上
              is_wall_or_block = isWallOrBlock(row - 1, column);
              moveCircle(row, column, row - 1, column, is_wall_or_block);
              break;
            case 39:
              // 右
              is_wall_or_block = isWallOrBlock(row, column + 1);
              moveCircle(row, column, row, column + 1, is_wall_or_block);
              break;
            case 40:
              // 下
              is_wall_or_block = isWallOrBlock(row + 1, column);
              moveCircle(row, column, row + 1, column, is_wall_or_block);
              break;
          }
        }
      });
    });

    /**
     * 指定マスが壁かブロックであるかを返却する
     * @param {Number} row 行
     * @param {Number}} column 列
     * @return {Bool} 壁かブロックならtrue/それ以外はfalse
     */
    function isWallOrBlock(row, column) {
      var IdNum = row*10+column;
        // 当該マスが存在しない.つまり壁.->T
        if(! $('#' + IdNum).length){
          return true;
        }      
        // class="block"ある.つまりブロック.->T
          if($('#'+IdNum).hasClass('block')){
          return true;
        }
        // 壁でもブロックでもないとき.->F        
          return false;
    }
    /**
     * 指定マスから指定マスに〇を移動する
     * @param {Number} row 現在の行
     * @param {Number}} column 現在の列
     * @param {Number} row 移動先の行
     * @param {Number}} column 移動先の列
     * @param {Number}} is_wall_or_block 壁かブロックかどうか
     */
     function moveCircle(from_row, from_column, to_row, to_column, is_wall_or_block) {
      // 壁かブロック何もしない.
      if(is_wall_or_block){
        return;
      }
      // 現在位置の〇削除.
      var FromNum=from_row*10+from_column;
      $('#'+FromNum ).text("");
      // 移動先に〇追加.
      var ToNum=to_row*10+to_column;
      $('#'+ToNum ).text("〇");     
    }
  </script>
</body>